# 🚀 SAR Бэктестинг Система с MACD Фильтрацией

Улучшенная торговая система на основе индикатора Parabolic SAR с фильтрацией MACD для повышения винрейта.

## 📋 Особенности

- ✅ **Высокий винрейт**: 52.8% (улучшено с 42.5%)
- 📈 **Отличная прибыльность**: +49.50% за период тестирования
- 🎯 **Профит-фактор**: 7.53 (очень высокий)
- 🛡️ **Низкая просадка**: всего 0.47%
- 📊 **MACD фильтрация**: Лояльные условия для качественных входов
- 📝 **Детальное логирование**: Все значения индикаторов при каждой сделке

## 🎯 Стратегия

**Классическая SAR + MACD тренд:**
- **Основа**: Parabolic SAR для сигналов входа/выхода
- **Фильтр**: MACD с часовых данных для подтверждения тренда
- **Таймфрейм**: 15 минут (основной), 1 час (MACD)
- **Символы**: FARTCOINUSDT, SOLUSDT
- **Период**: 2025-05-01 до 2025-08-14

## ⚡ Быстрый запуск

### Простой способ (один файл):

```bash
python3 main.py
```

Этот файл автоматически:
1. 📊 Генерирует демо данные
2. 🎯 Запускает бэктестинг
3. 📈 Создает отчеты и графики

### Пошаговый запуск:

```bash
# 1. Генерация данных
python3 demo_data_generator.py

# 2. Запуск бэктестинга
python3 demo_backtest.py
```

## 📦 Установка зависимостей

```bash
pip3 install --break-system-packages pandas numpy pybit matplotlib seaborn
```

**Преимущества:** Больше не требуется сложная установка `ta-lib`! Все технические индикаторы реализованы собственными функциями.

## 📁 Структура проекта

```
├── main.py                    # 🚀 ГЛАВНЫЙ ФАЙЛ ЗАПУСКА
├── config.py                  # ⚙️ Конфигурация
├── backtest_system.py         # 💼 Основная система бэктестинга
├── indicators.py              # 📊 Технические индикаторы (SAR, MACD)
├── data_fetcher.py            # 📡 Получение данных с Bybit
├── demo_data_generator.py     # 🎲 Генератор демо данных
├── demo_data_fetcher.py       # 📂 Работа с локальными данными
├── demo_backtest.py           # 🧪 Демо бэктестинг
├── demo_data/                 # 📁 Папка с демо данными
├── backtest_results/          # 📈 Результаты бэктестинга
└── README.md                  # 📖 Документация
```

## 📊 Результаты

После запуска вы получите:

- **📈 Графики**: `backtest_results/sar_backtest_charts.png`
- **📋 Детальные сделки**: `backtest_results/sar_trades.json`
- **📝 Лог выполнения**: `backtest.log`

## 📈 Примеры результатов

```
============================================================
РЕЗУЛЬТАТЫ КЛАССИЧЕСКОЙ PARABOLIC SAR СТРАТЕГИИ
============================================================
Период: 2025-05-01 - 2025-08-14
Символы: FARTCOINUSDT, SOLUSDT
Таймфрейм: 15m
Начальный капитал: $10,000.00

ТОРГОВАЯ СТАТИСТИКА:
Всего сделок: 981
Прибыльных: 518 (52.8%)
Убыточных: 463
✅ Хороший результат. Винрейт выше 50%
Общая прибыль: $4,949.96 (49.50%)
Итоговый капитал: $14,949.96
Профит-фактор: 7.53
Максимальная просадка: 0.47%
```

## 🔧 Настройки

Основные параметры в `config.py`:

```python
# Символы для торговли
SYMBOLS = ["FARTCOINUSDT", "SOLUSDT"]

# Период тестирования
START_DATE = "2025-05-01"
END_DATE = "2025-08-14"

# Параметры SAR
PSAR_CONFIG = {
    "start": 0.015,
    "increment": 0.015,
    "maximum": 0.15,
    "warmup_periods": 75,
    "strategy_mode": "classic"
}
```

## 📝 Детальное логирование

Каждая сделка содержит полную информацию:

```
INFO: Открыта long позиция по SOLUSDT по цене 158.2439 (SAR сигнал)
INFO:   SAR индикаторы: SAR=N/A, ATR=2.5849, RSI=9.06
INFO:   MACD тренд: Line=-4.3687, Signal=-5.1227, Hist=0.7541
INFO:   MACD состояние: Bullish=True, Bearish=False
INFO:   Тренд: EMA50=164.4834, EMA200=231.2533, Цена=158.2439
INFO:   Уровни: SL=151.7818, TP=171.1682
```

## 🎯 MACD Фильтрация

**Лояльные условия входа:**

- **Лонг**: `macd_trend_bullish=True` ИЛИ `macd_line > macd_signal`
- **Шорт**: `macd_trend_bearish=True` ИЛИ `macd_line < macd_signal`

Это обеспечивает хороший баланс между качеством сигналов и количеством сделок.

## ⚠️ Важные замечания

- 📊 Используются **демо данные** для тестирования
- 🔄 Для реальной торговли подключите API Bybit
- 📈 Результаты основаны на исторических данных
- ⚖️ Всегда тестируйте на демо счете перед реальной торговлей

## 🎉 Запуск

Просто выполните:

```bash
python3 main.py
```

И наслаждайтесь автоматическим анализом! 🚀

---

*Создано для демонстрации улучшенной SAR стратегии с MACD фильтрацией*